/*
 * this file is automatically generated for marvelous via zappjs
 * any manual changes to this file will be overwritten with the "mvs" command
 */

import * as http from 'http';
import * as url from 'url';

interface IClientOpts {
  url: string;
}

interface IClient {
  postAuthLogin: IClientPostAuthLoginFunction;
  postUsers: IClientPostUsersFunction;
}

export interface IClientPostAuthLoginFunction {
  (request?: IClientPostAuthLoginRequest): Promise<IClientPostAuthLoginResponse>;
}

export interface IClientPostAuthLoginRequest {
  name: string;
}

export interface IClientPostAuthLoginResponse {
}

export interface IClientPostUsersFunction {
  (request?: IClientPostUsersRequest): Promise<IClientPostUsersResponse>;
}

export interface IClientPostUsersRequest {
  name: string;
}

export interface IClientPostUsersResponse {
  id: string;
}


async function handler(req: any = {}, urlString: string = ''): Promise<any> {
  return new Promise((resolve, reject) => {
    try {
      const reqString = JSON.stringify(req);
      const urlParts = url.parse(urlString);
      
      const input = http.request(
        {
          protocol: urlParts.protocol,
          host: urlParts.hostname,
          port: urlParts.port,
          path: urlParts.pathname,
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Content-Length': Buffer.byteLength(reqString)
          }
        },
        output => {
          let responseString = '';

          output.on('data', chunk => {
            responseString += chunk;
          });

          output.on('end', () => {
            const response = JSON.parse(responseString) || {};
            if (output.statusCode === 200) {
              resolve(response);
            } else {
              reject(response);
            }
          });
        }
      );
      input.on('error', reject);
      input.write(reqString);
      input.end();
    } catch (error) {
      reject(error);
    }
  });
}

export class Client implements IClient {
  url = 'http://localhost:5000';

  constructor(opts?: IClientOpts) {
    if (opts && opts.url !== undefined) {
      this.url = opts.url;
    }
  }

  postAuthLogin: IClientPostAuthLoginFunction = async req => {
    return handler(req, `${this.url}/postAuthLogin`);
  };

  postUsers: IClientPostUsersFunction = async req => {
    return handler(req, `${this.url}/postUsers`);
  };
}
